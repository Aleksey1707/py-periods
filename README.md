# py-periods
Python application that can operate with periods

Простое приложение для работы с периодами в Python

# Основные возможности
* Сравнение периодов дат
    * Проверка вхождение даты/периода в заданный период (p1 in p2)
    * Проверка того, что окончание периода раньше сравниваемой даты/периода и они не пересекаются (p1 < p2)
    * Проверка того, что окончание периода раньше сравниваемой даты/периода и они пересекаются (p1 <= p2)
    * Проверка того, что окончание периода позже сравниваемой даты/периода и они не пересекаются (p1 > p2)
    * Проверка того, что окончание периода позже сравниваемой даты/периода и они пересекаются (p1 >= p2)
    * Проверка того, что периоды идентичны (p1 == p2)
    * Проверка того, что периоды не идентичны (p1 != p2)
* Арифметические операции с периодами дат
    * Операция сложения периодов (p1 + p2)
    * Операция разности периодов (p1 - p2)
* Получение количества дней в периоде (len(p1))
* Получение итератора периода (iter(p1))
* Разбиение периода по переданному периоду (p1.split(p2))
* Проверка пересечения периодов (p1.is_crossing(p2))
* Получение пересечения периодов (p1.crossing(p2))
* Сортировка периодов
* Циклическое вычетание периодов
* Циклическое пересечение периодов
* Циклическое сложение периодов

# Совместимость
* python 3.6+

# Использование

В примерах используется наглядное представление периодов и дат.
Периоды (DatePeriod) изображаются в виде интервала: |=======|
Даты (datetime, date) изображаются в виде точки: +
Графическое изображение примеров нужно читать слева направо, как будто это график.
То что находится левее — является более ранним событием.
То что находится правее — наступило позднее.

P.S.: Изначально этот модуль разрабатывался для работы с периодами, где дельта является днем.
Если необходимо работать с периодами в которых дельта является часом, минутой, секундой
или даже миллисекундой, то из коробки этот модуль не подойдет — придется дописывать данный функционал.

## 1. contains / in: Проверка вхождения даты/периода в данный период
```
Пример операции:
    item in self

Типы:
    item должен иметь тип такой же как у self.begin (datetime, date)
    или
    item должен быть экземпляром класса DatePeriod
    иначе
    вызывается TypeError

Примечание:
    Если периоды self и item равны, то операция тоже является истинной.

Пример истинной условной операции:
    1)
    self (DatePeriod):      |========|
    item (datetime, date):      +

    2)
    self (DatePeriod): |========|
    item (DatePeriod):    |===|

    3)
    self (DatePeriod): |========|
    item (DatePeriod): |========|
```

## 2. lt / <: Проверка того, что данный период закончился раньше сравниваемой даты/периода и они НЕ ПЕРЕСЕКАЮТСЯ
```
Пример операции:
    self < other

Типы:
    other должен иметь тип такой же как у self.begin (datetime, date)
    или
    other должен быть экземпляром класса DatePeriod
    иначе
    вызывается TypeError

Примеры истинной условной операции:
    1)
    self (DatePeriod):      |========|
    other (datetime, date):              +

    2)
    self (DatePeriod):  |========|
    other (DatePeriod):              |===|
```

## 3. le / <=: Проверка того, что данный период закончился раньше переданной периода и они ПЕРЕСЕКАЮТСЯ
```
Пример операции:
    self < other

Типы:
    other должен иметь тип такой же как у self.begin (datetime, date)
    или
    other должен быть экземпляром класса DatePeriod
    иначе
    вызывается TypeError

Примеры истинной условной операции:
    1)
    self (DatePeriod):      |========|
    other (datetime, date):              +

    2)
    self (DatePeriod):  |========|
    other (DatePeriod):              |===|
```

## 4. gt / >: Проверка того, что данный период закончился позже сравниваемой даты/периода и они НЕ ПЕРЕСЕКАЮТСЯ
```
Пример операции:
    self > other

Типы:
    other должен иметь тип такой же как у self.begin (datetime, date)
    или
    other должен быть экземпляром класса DatePeriod
    иначе
    вызывается TypeError

Примеры истинной условной операции:
    1)
    self (DatePeriod):            |========|
    other (datetime, date):   +

    2)
    self (DatePeriod):          |========|
    other (DatePeriod):  |===|
```

## 5. ge / >=: Проверка того, что данный период закончился позже переданной периода и они ПЕРЕСЕКАЮТСЯ
```
Пример операции:
    self >= other

Типы:
    other должен быть экземпляром класса DatePeriod
    иначе
    вызывается TypeError

Подробное описание:
    Истинным выражение будет если
    текущий период наступил раньше второго периода и они ОБЯЗАТЕЛЬНО должны пересекаться

    ВАЖНО:
        Если условие (other in self) или (self in other) истинно, то тогда операция является ЛОЖНОЙ

        Если нужно проверить что период наступил раньше или позже другого периода, то
        лучше воспользоваться функциями compare_begin или compare_end

Пример истинной условной операции:
    self (DatePeriod):        |========|
    other (DatePeriod):  |=======|
```

## 6. eq / ==: Проверка того, что данный период идентичен второму периоду
```
Пример операции:
    self == other

Типы:
    other должен иметь тип такой же как у self.begin (datetime, date)
    или
    other должен быть экземпляром класса DatePeriod
    иначе
    вызывается TypeError

Подробное описание:
    В случае если происходит сравнение с datetime или date, то операция ВСЕГДА ЛОЖНАЯ

    В случае если происходит сравнение с DatePeriod, то истинной операция будет если
    текущий период полностью идентичен второму периоду

Пример истинной условной операции:
    self (DatePeriod):  |========|
    other (DatePeriod): |========|
```

## 7. ne / !=: Проверка того, что данный период не является идентчиным второму периоду
```
Пример операции:
    self != other

Типы:
    other должен иметь тип такой же как у self.begin (datetime, date)
    или
    other должен быть экземпляром класса DatePeriod
    иначе
    вызывается TypeError

Подробное описание:
    В случае если происходит сравнение с datetime или date, то операция ВСЕГДА ИСТИННАЯ

    В случае если происходит сравнение с DatePeriod, то истинной операция будет если
    текущий период не идентичен второму периоду

Примеры истинной условной операции:
    1)
    self (DatePeriod):      |========|
    other (datetime, date):        +

    2)
    self (DatePeriod):  |========|
    other (DatePeriod):      |========|
```

## 8. add / +: Производит операцию добавления периода
```
Пример операции:
    self + other

Типы:
    self и other должны быть экземплярами класса DatePeriod
    иначе
    вызывается TypeError

Подробное описание:
    Происходит разное поведение операции в зависимости от переданных периодов, а именно:

    1) Периоды не пересекаются.

        В этом случае просто возвращается список, состоящий из этих двух периодов

        Пример:
            self (DatePeriod):              |========|
            other (DatePeriod):  |=======|

            return: [self, other]

    2) Добавляемый период полностью входит в данный период.

        Т.е. выполняется условие other in self

        Атрибут self.data сохраняется.

        Пример:
            self (DatePeriod):   |========|
            other (DatePeriod):    |===|

            return: [self,]

    3) Добавляемый период равен данному периоду.

        Т.е. выполняется условие other == self

        Атрибут self.data сохраняется.

        Пример:
            self (DatePeriod):   |========|
            other (DatePeriod):  |========|

            return: [self,]

    4) Текующий период полностью входит в добавляемый период.

        Т.е. выполняется условие self in other

        ВАЖНО:
            Если self.protect_data истинно, тогда в возвращаемом результате other.data = self.data
            иначе
            атрибут self.data теряется

        Пример:
            self (DatePeriod):     |====|
            other (DatePeriod):  |========|

            return: [other,]

    5) Текующий период наступил раньше добавляемого периода и они ПЕРЕСЕКАЮТСЯ

        Т.е. выполняется условие self <= other

        Атрибут res.data = self.data. Атрибут other.data теряется.

        Пример:
            self (DatePeriod):   |====|
            other (DatePeriod):     |========|

            res (DatePeriod):    |===========|

            return: [res,]

    6) Текующий период наступил позже добавляемого периода и они ПЕРЕСЕКАЮТСЯ

        Т.е. выполняется условие self >= other

        Атрибут res.data = self.data. Атрибут other.data теряется.

        Пример:
            self (DatePeriod):          |====|
            other (DatePeriod):  |========|

            res (DatePeriod):    |===========|

            return: [res,]

    Исключение ValueError вызывается в случае, если что-то не предусмотрено.
```

## 9. sub / -: Производит операцию вычитания периода
```
Пример операции:
    self - other

Типы:
    self и other должны быть экземплярами класса DatePeriod
    иначе
    вызывается исключение TypeError

Подробное описание:
    Происходит разное поведение операции в зависимости от переданных периодов, а именно:

    1) Периоды не пересекаются.

        В этом случае возвращается список, состоящий только из текущего периода

        Атрибут self.data сохраняется

        Пример:
            self (DatePeriod):              |========|
            other (DatePeriod):  |=======|

            return: [self,]

    2) Периоды идентичны.

        В этом случае возвращается пустой список

        Пример:
            self (DatePeriod):   |=======|
            other (DatePeriod):  |=======|

            return: []

    3) Данный период (self) входит в вычитаемый период (other)

        В этом случае возвращается пустой список

        Пример:
            self (DatePeriod):     |===|
            other (DatePeriod):  |=======|

            return: []

    4) Вычитаемый период (other) входит в данный период (self).

        4.1) Начало обоих периодов идентичны

            Атрибут res.data = self.data. Атрибут other.data теряется.

            Пример:
                self (DatePeriod):   |========|
                other (DatePeriod):  |===|
                res (DatePeriod):         |===|

                return: [res,]

        4.2) Окончание обоих периодов идентичны

            Атрибут res.data = self.data. Атрибут other.data теряется.

            Пример:
                self (DatePeriod):   |========|
                other (DatePeriod):       |===|
                res (DatePeriod):    |===|

                return: [res,]

        4.3) Иначе возвращается список состоящий из двух периодов

            Атрибут res1.data = res2.data = self.data. Атрибут other.data теряется.

            Пример:
                self (DatePeriod):   |===========|
                other (DatePeriod):      |===|
                res1 (DatePeriod):   |==|
                res2 (DatePeriod):            |==|

                return: [res1, res2]

    5) Текующий период (self) наступил раньше вычитаемого периода (other) и они ПЕРЕСЕКАЮТСЯ

        Т.е. выполняется условие self <= other

        Атрибут res.data = self.data. Атрибут other.data теряется.

        Пример:
            self (DatePeriod):   |======|
            other (DatePeriod):      |========|
            res (DatePeriod):    |==|

            return: [res,]

    6) Текующий период (self) наступил позже вычитаемого периода (other) и они ПЕРЕСЕКАЮТСЯ

        Т.е. выполняется условие self >= other

        Атрибут res.data = self.data. Атрибут other.data теряется.

        Пример:
            self (DatePeriod):      |========|
            other (DatePeriod):  |======|
            res (DatePeriod):            |===|

            return: [res,]

    Исключение ValueError вызывается в случае, если что-то не предусмотрено.
```

## 10. len: Возвращает количество дней в периоде

## 11. iter: Итератор, возвращающий даты каждого дня данного периода


## 12. split(other): Разбиение данного периода на периоды по переданному периоду (other).
```
Пример операции:
    self.split(other)

Типы:
    other должен быть экземпляром класса DatePeriod
    иначе
    вызывается исключение TypeError

Подробное описание:
    Данная операция очень напоминает операцию вычитания периода,
    но отличается тем, что пересечение с переданным периодом (other) так же попадает в результат

    Происходит разное поведение операции в зависимости от переданных периодов, а именно:

    1) Периоды не пересекаются.

        Пример:
        self (DatePeriod):  |========|
        other (DatePeriod):             |=======|

        return: [self,]

    2) Переданный период (other) входит в текущий период (self).

        Атрибут res1.data = res2.data = cross.data = self.data. Атрибут other.data теряется.

        Пример:
        self (DatePeriod):  |============|
        other (DatePeriod):    |====|

        res1 (DatePeriod):  |=|
        cross (DatePeriod):    |====|
        res2 (DatePeriod):           |===|

        return: [res1, cross, res2]

    3) Текущий период (self) входит в переданный период (other).

        В этом случае возвращается пустой список

        Пример:
        self (DatePeriod):       |===|
        other (DatePeriod): |==========|

        return: [self, ]

    4) Периоды равны.

        Пример:
        self (DatePeriod):  |==========|
        other (DatePeriod): |==========|

        return: [self, ]

    5) Текущий период (self) наступил раньше переданного периода (other)

        Атрибут res1.data = res2.data = cross.data = self.data. Атрибут other.data теряется.

        Пример:
        self (DatePeriod):  |========|
        other (DatePeriod):       |=======|

        res (DatePeriod):   |====|
        cross (DatePeriod):       |==|

        return: [res1, cross]

    6) Текущий период (self) наступил позже переданного периода (other)

        Атрибут res1.data = res2.data = cross.data = self.data. Атрибут other.data теряется.

        Пример:
        self (DatePeriod):       |========|
        other (DatePeriod): |=======|

        cross (DatePeriod):       |==|
        res (DatePeriod):             |===|

        return: [cross, res]

    Исключение ValueError вызывается в случае, если что-то не предусмотрено.
```

## 13. is_crossing(other): Проверка того, что текущий период (self) пересекается с переданным периодом (other).
Пример операции:
    self.is_crossing(other)

Типы:
    other должен быть экземпляром класса DatePeriod
    иначе
    вызывается исключение TypeError

Возвращает логическое значение bool

## 14. crossing(other): Получение пересечения текущего периода (self) с переданным периодом (other).
Пример операции:
    self.crossing(other)

Типы:
    other должен быть экземпляром класса DatePeriod
    иначе
    вызывается исключение TypeError

Возвращает экземпляр класса DatePeriod, который является пересечением периодов self и other, при условии, что
периоды self и other пересекаются (атрибут data, возвращаемого значения равен self.data)
иначе
возвращается None

## 15. must_crossing(other): Получение пересечения текущего периода (self) с переданным периодом (other).
Пример операции:
    self.must_crossing(other)

Типы:
    other должен быть экземпляром класса DatePeriod
    иначе
    вызывается исключение TypeError

Возвращает экземпляр класса DatePeriod, который является пересечением периодов self и other, при условии, что
периоды self и other пересекаются (атрибут data, возвращаемого значения равен self.data)
иначе
вызывается ValueError

## 16. Сортировка
Из-за того, что методы сравнения переопределены и работают "интересным" способом, то при 
сортировке списка объектов DatePeriod, методы sort и sorted без переданных пользовательских 
функций key, отсортируют список НЕ ВЕРНО.

Пример сортировки:
sorted([p1, p2, p3, p4, p5], key=lambda x: x.begin, x.end)
или
[p1, p2, p3, p4, p5].sort(key=lambda x: x.begin, x.end)
